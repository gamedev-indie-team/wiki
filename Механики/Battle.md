# Процесс битвы

Механика битвы в себе содержит 4 основные части:

- battle - основные механики битвы
- prepare - механика подготовки урона
- damage - механика расчета и нанесения урона
- dead - механика смерти

## Battle

Содержит в себе следующие компоненты:

- урон
- карта нанесения урона
- сопротивление|уязвимость
- флаг получения урона и события добавления/удаления
- флаг того, что сущность бьёт и события добавления/удаления

Также в системах битвы описано создание сущности попадания удара в триггер цели и добавление/удаление флагов получения урона и того, что сущность бьёт

## Prepare

Механика подготовки урона основана на двух системах:

1. смотрит наличие какой-либо характеристики, которой можно нанести урон
2. если после первой системы остались сущности, то собираем урон по характеристикам, которые есть у сущности цели и создаём новую сущность с подготовленным уроном

## Damage

Механика урона выполняет разделение урона по характеристикам и вычисляет урон в зависимости от наличия критического удара и сопротивления|уязвимости, а также учитывает переодический урон

Урон - количество урона от `0` до `∞`.  
Фактор - множитель урона от `0` до `∞`.  
Шанс критического урона - вероятность с которой произойдет крит. урон и имеет значение от `0` до `1`.

1. переодический урон через определённый период времени создаёт копию сущности подготовленного урона, который по дальнейшим система, оригинальная сущность с таймерам по истечении всех итераций и времени будет удалена
2. система добавления крита увеличивает урон по формуле, если крит произошёл. Формула по умолчанию `урон \* (1 + фактор)`. Формула может быть заменена.
3. урон разделяется по типам урона|сопротивления и характеристике, по которой наносится урон, далее создаётся сущность с перечисленными ранее параметрами и количеством урона|сопротивления
4. вычисление урона в зависимости от сопротивления|уязвимости по формуле `рассчитанный урон = урон * (0.5 - ( сопротивление - |сопротивление - 1| ) / 2)`
5. нанесение урона по характеристике, которая указана в сущности

## Dead

Механика смерти содержит в себе следующие системы

- отключение симуляции умершего тела
- разбрасывает предметы, если есть инвентарь
- скрывает представление через некоторое время, после окончания анимации смерти
